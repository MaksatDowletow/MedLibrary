# MedLibrary

Интерактивная витрина медицинской электронной библиотеки с формами регистрации и входа. Репозиторий содержит статический фронтенд (страница `index.html`) и небольшой Node.js/Express API (`server.js`).

## Запуск API локально

1. Скопируйте файл `.env.example` и переименуйте в `.env`. Укажите строку подключения к MongoDB и секрет для JWT.
2. Установите зависимости и запустите сервер:

```bash
npm install
npm run dev
```

По умолчанию сервер слушает порт `5000`.

> **Примечание.** Если MongoDB временно недоступна, API автоматически переключится на встроенное файловое хранилище `data/users.json`. Пароли в нём сохраняются в виде bcrypt-хешей, поэтому даже без БД можно продолжать локальную разработку и тестирование. Для продакшена по-прежнему рекомендуется полноценная база данных.

## Настройка фронтенда

Форма авторизации на главной странице обращается к API по адресу из атрибута `data-api-base` тега `<body>`. Значение можно переопределить параметром `?apiBase=https://your-api.example.com`. На локальной разработке оставьте `http://localhost:5000`.

### Офлайн-режим

Если браузеру не удаётся связаться с указанным API (например, сервер не запущен), интерфейс автоматически переключается в офлайн-режим:

- регистрация сохраняет учётные записи в `localStorage` браузера;
- вход сверяет логин/пароль с локально сохранёнными пользователями и создаёт локальную сессию;
- статус авторизации отображается с пометкой «офлайн».

Чтобы сбросить локальные данные, очистите `localStorage` (кнопка «Выход» также удаляет офлайн-сессию). Как только API снова станет доступен, форма автоматически вернётся к работе через сервер и перестанет использовать локальный fallback.

## Маршруты API

- `POST /register` – регистрация пользователя.
- `POST /login` – вход и получение JWT.
- `POST /auth/google` – вход через Google Identity (OAuth 2.0, ID Token).
- `GET /session` – проверка текущего токена.
- `GET /protected` – пример защищённого ресурса.

Все маршруты возвращают сообщения об ошибках в формате JSON, что позволяет фронтенду выводить осмысленные уведомления пользователям.

## Подключение Google Identity

1. Получите OAuth 2.0 Client ID в [Google Cloud Console](https://console.cloud.google.com/apis/credentials). Для тестов можно использовать тип `Web` и добавить `http://localhost:5000` в список разрешённых источников.
2. Укажите Client ID в `.env` (переменная `GOOGLE_CLIENT_ID`). Можно перечислить несколько идентификаторов через запятую. При необходимости ограничьте доменом `GOOGLE_ALLOWED_HD=example.com`.
3. На фронтенде задайте тот же Client ID через атрибут `data-google-client-id` тега `<body>`, через мета-тег `<meta name="google-client-id" ...>` или параметр `?googleClientId=` в URL.
4. После этого в блоке авторизации появится кнопка «Войти через Google». Пользователь получает обычный JWT, а сервер создаёт локальную учётную запись автоматически, используя адрес электронной почты из Google.

Отдельная страница `auth.html` использует те же настройки, поэтому достаточно поделиться ссылкой вроде `auth.html?apiBase=https://api.example.com&googleClientId=XXX`.
